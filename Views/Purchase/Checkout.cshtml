@using EXE202.Utils
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Purchase - OceanBooking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/SiteImages/OCBK_LOGO.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@fancyapps/ui/dist/fancybox.css" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            margin-top: 20px;
            background-color: #f1f3f7;
            background-image: url('/images/SiteImages/VINHOME_GENERAL.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
        }

        .text-muted {
            --bs-text-opacity: 1;
            color: #f8f9fa !important;
        }

        .card {
            margin-bottom: 24px;
            -webkit-box-shadow: 0 2px 3px #e4e8f0;
            box-shadow: 0 2px 3px #e4e8f0;
        }

        .card {
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #373b3e85;
            background-clip: border-box;
            border: 1px solid #eff0f2;
            border-radius: 1rem;
        }

        .activity-checkout {
            list-style: none
        }

            .activity-checkout .checkout-icon {
                position: absolute;
                top: -4px;
                left: -24px
            }

            .activity-checkout .checkout-item {
                position: relative;
                padding-bottom: 24px;
                padding-left: 35px;
                border-left: 2px solid #f5f6f8
            }

                .activity-checkout .checkout-item:first-child {
                    border-color: #3b76e1
                }

                    .activity-checkout .checkout-item:first-child:after {
                        background-color: #3b76e1
                    }

                .activity-checkout .checkout-item:last-child {
                    border-color: transparent
                }

                .activity-checkout .checkout-item.crypto-activity {
                    margin-left: 50px
                }

                .activity-checkout .checkout-item .crypto-date {
                    position: absolute;
                    top: 3px;
                    left: -65px
                }



        .avatar-xs {
            height: 1rem;
            width: 1rem
        }

        .avatar-sm {
            height: 2rem;
            width: 2rem
        }

        .avatar {
            height: 3rem;
            width: 3rem
        }

        .avatar-md {
            height: 4rem;
            width: 4rem
        }

        .avatar-lg {
            height: 5rem;
            width: 5rem
        }

        .avatar-xl {
            height: 6rem;
            width: 6rem
        }

        .avatar-title {
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            background-color: #3b76e1;
            color: #fff;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            font-weight: 500;
            height: 100%;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            width: 100%
        }

        .avatar-group {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            padding-left: 8px
        }

            .avatar-group .avatar-group-item {
                margin-left: -8px;
                border: 2px solid #fff;
                border-radius: 50%;
                -webkit-transition: all .2s;
                transition: all .2s
            }

                .avatar-group .avatar-group-item:hover {
                    position: relative;
                    -webkit-transform: translateY(-2px);
                    transform: translateY(-2px)
                }

        .card-radio {
            background-color: #fff;
            border: 2px solid #eff0f2;
            border-radius: .75rem;
            padding: .5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block
        }

            .card-radio:hover {
                cursor: pointer
            }

        .card-radio-label {
            display: block
        }

        tbody, td, tfoot, th, thead, tr {
            border-color: inherit;
            border-style: solid;
            border-width: 0;
            color: antiquewhite;
        }

        .edit-btn {
            width: 35px;
            height: 35px;
            line-height: 40px;
            text-align: center;
            position: absolute;
            right: 25px;
            margin-top: -50px
        }

        .card-radio-input {
            display: none
        }

            .card-radio-input:checked + .card-radio {
                border-color: #3b76e1 !important
            }


        .font-size-16 {
            font-size: 16px !important;
        }

        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        a {
            text-decoration: none !important;
        }


        .form-control {
            display: block;
            width: 100%;
            padding: 0.47rem 0.75rem;
            font-size: .875rem;
            font-weight: 400;
            line-height: 1.5;
            color: #545965;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #e2e5e8;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0.75rem;
            -webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
            transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        }

        .edit-btn {
            width: 35px;
            height: 35px;
            line-height: 40px;
            text-align: center;
            position: absolute;
            right: 25px;
            margin-top: -50px;
        }

        .ribbon {
            position: absolute;
            right: -26px;
            top: 20px;
            -webkit-transform: rotate(45deg);
            transform: rotate(45deg);
            color: #fff;
            font-size: 13px;
            font-weight: 500;
            padding: 1px 22px;
            font-size: 13px;
            font-weight: 500
        }

        .text-dark {
            --bs-text-opacity: 1;
            color: #dee2e6 !important;
        }

        .h5, h5 {
            font-size: large;
        }

        .card-radio-input:checked + .card-radio {
            border-color: #3b76e1 !important;
            border: 5px solid;
        }
    </style>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css"
          integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/main_style/css/style.css">
    <link href="~/css/site.css" rel="stylesheet" />
</head>

<body>
    <header class="site-navbar site-navbar-target" role="banner" style="background-color: rgba(79, 173, 201, 0.5);">
        <div class="container">
            <div class="row align-items-center position-relative">
                <div class="col-8">
                    <div class="site-logo">
                        <a href="@Url.Action("LoadHomestay", "Homestay")"><img style="width: 350px; font-weight: bold" src="/images/SiteImages/OCBK_LOGO_TEXT_WHITE.png" /></a>
                    </div>
                </div>

                <div class="col-4">
                    <span class="d-inline-block d-lg-none"><a href="#" class="text-white site-menu-toggle js-menu-toggle py-5 text-white"><span class="icon-menu h3 text-white"></span></a></span>
                    <nav class="site-navigation ml-auto d-none d-lg-block" role="navigation">
                        <ul class="site-menu main-menu js-clone-nav ml-auto">
                            @if (ViewBag.name == null)
                            {
                                <li><a href="@Url.Action("Login", "Login")" class="nav-link">ĐĂNG NHẬP</a></li>
                                <li><a href="@Url.Action("SignUp", "SignUp")" class="nav-link">ĐĂNG KÝ</a></li>
                            }
                            else
                            {
                                <li><a href="@Url.Action("Profile", "Profile")" class="nav-link">Xin chào @ViewBag.name</a></li>
                                <li><a href="@Url.Action("Logout", "Login")" class="nav-link">ĐĂNG XUẤT</a></li>
                            }
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

<div class="container">
    <div class="row" style="margin-top: 150px">
        <div class="col-xl-7">
            <div class="card">
                <div class="card-body">
                    <ol class="activity-checkout mb-0 px-4 mt-3">
                        <li class="checkout-item">
                            <div class="avatar checkout-icon p-1">
                                <div class="avatar-title rounded-circle bg-primary">
                                    <i class="bx bxs-receipt text-white font-size-20"></i>
                                </div>
                            </div>

                        </li>
                        <li class="checkout-item">

                            <div class="feed-item-list">
                                <div>
                                    <h5 style="color:#ffc107" class="font-size-16 mb-1">THÔNG TIN NGƯỜI NHẬN</h5>
                                    <p class="text-muted text-truncate mb-4">Thông tin chi tiết Homestay sẽ được gửi qua email của bạn.</p>
                                    <div class="mb-3">
                                        <div class="row">
                                            <div class="col-lg-6 col-sm-6">
                                                <div data-bs-toggle="collapse">
                                                    <label class="card-radio-label mb-0">
                                                        <input type="radio" name="address" id="info-address1"
                                                               class="card-radio-input" checked>
                                                        <div class="card-radio text-truncate p-3">
                                                            <span class="fs-14 mb-2 d-block">
                                                                @ViewBag.contract.FirstName @ViewBag.contract.LastName
                                                            </span>
                                                            <span class="fw-normal text-wrap mb-1 d-block">
                                                                @ViewBag.contract.Phone
                                                            </span>
                                                            <span class="fw-normal d-block">
                                                                @ViewBag.contract.Email
                                                            </span>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="checkout-item">
                            <div class="avatar checkout-icon p-1">
                                <div class="avatar-title rounded-circle bg-primary">
                                    <i class="bx bxs-wallet-alt text-white font-size-20"></i>
                                </div>
                            </div>
                            <div class="feed-item-list">
                                <div>
                                    <h5 style="color:#ffc107" class="font-size-16 mb-1">THÔNG TIN THANH TOÁN</h5>
                                    <p class="text-muted text-truncate mb-4">Hãy chọn phương thức thanh toán cho hoá đơn này</p>
                                </div>
                                @* <div> *@
                                @*     <div class="row"> *@
                                @*         <div class="col-lg-4 col-sm-6"> *@
                                @*             <div data-bs-toggle="collapse"> *@
                                @*                 <label class="card-radio-label"> *@
                                @*                     <input type="radio" name="payment_method" value="CarRentalPAY" id="pay-methodoption1" class="card-radio-input" onchange="handlePaymentChange(this)" *@
                                @*                            @(ViewBag.formattedDiscount != "0" ? "checked" : "")> *@
                                @*                     <span class="card-radio py-3 text-center text-truncate"> *@
                                @*                         <i class="bx bx-credit-card d-block h2 mb-3"></i> *@
                                @*                         OceanPAY *@
                                @*                         <br />@ViewBag.account_balance VNĐ *@
                                @*                     </span> *@
                                @*                 </label> *@
                                @*             </div> *@
                                @*         </div> *@
                                @*         <script> *@
                                @*                 function handlePaymentChange(radio) { *@
                                @*                     if (radio.value === 'CarRentalPAY') { *@
                                @*                         window.location.href = '@Url.Action("PurchaseByOceanPAY", "Purchase")'; *@
                                @*                     } else if (radio.value === 'Paypal') { *@
                                @*                         window.location.href = '@Url.Action("PurchaseByPaypal", "Purchase")'; *@
                                @*                     } *@
                                @*                 } *@
                                @*             </script> *@
                                @*     </div> *@
                                @* </div> *@
                                <div>
                                    <a href="@ViewBag.QrCode" data-fancybox="gallery">
                                        <img height="200px" src="@ViewBag.QrCode" />
                                    </a>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="row my-4">
                <div class="col">
                    <a href="javascript:history.back()" class="btn btn-link text-muted">
                        <i class="mdi mdi-arrow-left me-1"></i> Quay lại
                    </a>
                </div>
            </div>
        </div>
        <div class="col-xl-5">
            <div class="card checkout-order-summary">
                <div class="card-body">
                    <div>
                        <h5 style="color:#ffc107" class="font-size-24 mb-1">TÓM TẮT HOÁ ĐƠN</h5>
                        <p class="text-muted text-truncate mb-4">Hãy kiểm tra lại kỹ thông tin hoá đơn trước khi xác nhận thanh toán</p>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-centered mb-0 table-nowrap">
                            <thead style="color:white">
                            <tr>
                                <th class="border-top-0" scope="col">Homestay</th>
                                <th class="border-top-0" scope="col"></th>
                                <th class="border-top-0" scope="col">Giá</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <h5 class="font-size-16 text-truncate">
                                        <a href="#"
                                           class="text-dark">@ViewBag.homestay.Name</a>
                                    </h5>
                                    <p class="text-muted mb-0 mt-1">@CurrencyHelper.GetFormatedCurrency(@ViewBag.homestay.PricePerNight.ToString()) VNĐ x @ViewBag.number_of_day ngày</p>
                                </td>
                                <td></td>
                                <td>@CurrencyHelper.GetFormatedCurrency(@ViewBag.contract.TotalAmount.ToString()) VNĐ</td>
                            </tr>
                            <tr class="bg-light">
                                <td colspan="2">
                                    <h5 style="color: black; font-weight:bold" class="font-size-16 m-0">TỔNG HOÁ ĐƠN:</h5>
                                </td>
                                <td style="color:black; font-weight:bold">
                                    @ViewBag.total VNĐ
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col">
                @if (ViewBag.error == null)
                {
                    <div class="text-end mt-2 mt-sm-0">
                        @* <a href="@(ViewBag.formattedDiscount != "0" ? Url.Action("CheckpointPurchase", "Purchase") : Url.Action("CheckoutRedirectPaypal", "Purchase", new { amount = ViewBag.total }))" class="btn btn-success w-100 text-lg-center">
                            <i class="mdi mdi-cart-outline me-1"></i> Xác nhận thanh toán
                        </a> *@
                        <a href="#" class="btn btn-success w-100 text-lg-center disabled">
                            <i class="mdi mdi-cart-outline me-1"></i> Vui lòng quét mã QR để tự động xác nhận thanh toán
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>

</div>

    <style>
        .fab {
            position: fixed; /* Đảm bảo nút luôn ở cùng một vị trí trên màn hình */
            bottom: 40px; /* Cách cạnh dưới của màn hình 20px */
            right: 40px; /* Cách cạnh phải của màn hình 20px */
        }

        .fab-button {
            display: inline-block;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 24px;
            line-height: 60px;
            text-align: center;
            border-radius: 50%;
            text-decoration: none;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
            display: inline-block;
            position: relative;
            animation: ring 1.5s infinite;
        }

            .fab-button:hover {
                background-color: #e57373; /* Màu sáng hơn khi di chuột */
            }

        @@keyframes ring {
            0% {
                transform: rotate(0deg);
            }

            10% {
                transform: rotate(15deg);
            }

            20% {
                transform: rotate(-10deg);
            }

            30% {
                transform: rotate(5deg);
            }

            40% {
                transform: rotate(-5deg);
            }

            50% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(0deg);
            }
        }

    </style>

    <div class="fab">
        <div class="row">
            <a href="tel:0968047703" target="_blank" class="fab-button">
                <img style="max-height: 100%" src="https://cdn-icons-png.flaticon.com/512/6815/6815116.png" />
            </a>
        </div>
        <div class="row mt-3">
            <a href="https://zalo.me/0968047703" target="_blank" class="fab-button">
                <img style="max-height: 100%" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Icon_of_Zalo.svg/768px-Icon_of_Zalo.svg.png" />
            </a>
        </div>
        <div class="row mt-3">
            <a href="https://m.me/456249630899482" target="_blank" class="fab-button">
                <img style="max-height: 100%" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Facebook_Messenger_logo_2020.svg/768px-Facebook_Messenger_logo_2020.svg.png" />
            </a>
        </div>
    </div>

    <footer class="site-footer" style="background-color: #4fadc9">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-sm-12 mt-4">
                    <h2 class="footer-heading mb-4">VỀ CHÚNG TÔI</h2>
                    <p class="text-justify">OceanBooking là nền tảng trung gian giúp cho việc đặt homestay tại Vinhome Ocean Park Gia Lâm của bạn trở nên dễ dàng, thuận tiện hơn.</p>
                </div>
                <div class="col-lg-2 col-sm-12 mt-4"></div>
                <div class="col-lg-7 ml-auto col-sm-12">
                    <div class="row">
                        <div class="col-lg-6 col-sm-12 mt-4">
                            <h2 class="footer-heading mb-4">LIÊN KẾT XÃ HỘI</h2>
                            <ul class="list-unstyled">
                                <li>
                                    <a style="color: whitesmoke" href="https://www.facebook.com/profile.php?id=61565969259252" target="_blank"><i class="fa-brands fa-facebook-f"></i> Facebook</a>
                                </li>
                                <li>
                                    <a style="color: whitesmoke" href="mailto:oceanbooking01@gmail.com"><i class="fa-regular fa-envelope"></i> oceanbooking01@gmail.com</a>
                                </li>
                                <li>
                                    <a style="color: whitesmoke" href="tel:0968047703"><i class="fa-solid fa-phone"></i> 0968047703</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-6 col-sm-12 mt-4">
                            <h2 class="footer-heading mb-4">THOẢ THUẬN NGƯỜI DÙNG</h2>
                            <ul class="list-unstyled">
                                <li><a style="color: whitesmoke" href="@Url.Action("TermsOfUse", "PageInformation")">Điều khoản dịch vụ</a></li>
                                <li><a style="color: whitesmoke" href="@Url.Action("PrivacyPolicy", "PageInformation")">Quyền riêng tư và bảo mật</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <script src="@Url.Content("~/js/lib/signalr/dist/browser/signalr.min.js")"></script>
<script>
    const customerId = "@ViewBag.CustomerId"; // Sử dụng customerId từ ViewBag hoặc một nguồn khác
    const connection = new signalR.HubConnectionBuilder()
        .withUrl(`/transactionHub?customerId=${customerId}`) // Truyền customerId trong URL
        .withAutomaticReconnect()
        .build();

        connection.start().then(() => {
            console.log('Connected to the hub');
        }).catch(err => console.error(err.toString()));

        connection.on("TransactionSuccess", () => {
            Swal.fire({
                title: 'Thanh toán thành công!',
                text: 'Bấm OK để tiếp tục',
                icon: 'success',
                confirmButtonText: 'OK'
            }).then((result) => {
                window.location.href = '@Url.Action("PurchaseConfirmation", "Purchase")';
            });
        });
</script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@fancyapps/ui/dist/fancybox.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">

    </script>
</body>

</html>